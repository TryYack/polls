{"ast":null,"code":"var _jsxFileName = \"/Users/joduplessis/Work/Weekday/polls/components/poll.component.js\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from 'react';\nimport { Progress, Button } from '@weekday/elements';\nimport moment from 'moment';\nimport { useMutation, useSubscription } from '@apollo/react-hooks';\nimport gql from 'graphql-tag';\nconst DELETE_POLL = gql`\n  mutation delete_polls($id: Int) {\n    delete_polls(\n      where: {id: {_eq: $id}}\n    ) {\n      affected_rows\n    }\n  }\n`;\nexport default function PollComponent(props) {\n  const {\n    0: complete,\n    1: setComplete\n  } = useState(false);\n  const {\n    0: total,\n    1: setTotal\n  } = useState(0);\n  const {\n    0: highest,\n    1: setHighest\n  } = useState(0);\n  const {\n    0: expired,\n    1: setExpired\n  } = useState(0);\n  const [deletePoll, deleteData] = useMutation(DELETE_POLL);\n\n  const updatePoll = async () => {\n    console.log('Open action window');\n  };\n\n  const confirmDeletePoll = async () => {\n    if (confirm(\"Are you sure?\")) {\n      deletePoll({\n        variables: {\n          id: props.id\n        }\n      });\n    }\n  };\n\n  const voteOption = async optionId => {\n    props.onSubmit(optionId);\n    setComplete(true);\n  };\n\n  useEffect(() => {\n    let voteCountHighest = 0;\n    props.options.map(option => {\n      // See if this user has completed the poll\n      props.pollVotes.map(vote => {\n        if (vote.user_id == props.currentUserId) setComplete(true);\n      }); // Set the score for the highest amount of votes\n\n      voteCountHighest = props.pollVotes.filter(vote => vote.option_id == option.id).length;\n    });\n    setTotal(props.pollVotes.length);\n    setHighest(voteCountHighest);\n    setExpired(moment(props.expiry).isBefore(moment()));\n  }, [props]);\n  useEffect(() => {\n    window.top.postMessage({\n      type: 'weekday',\n      payload: {\n        text: 'Here we go'\n      }\n    }, '*');\n  }, []);\n  return __jsx(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67\n    },\n    __self: this\n  }, __jsx(_JSXStyle, {\n    id: \"4211460005\",\n    __self: this\n  }, \".poll-container.jsx-4211460005{width:100%;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-bottom:20px;}.poll-inner.jsx-4211460005{-webkit-flex:1;-ms-flex:1;flex:1;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}.progress-container.jsx-4211460005{margin-bottom:5px;width:100%;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9qb2R1cGxlc3Npcy9Xb3JrL1dlZWtkYXkvcG9sbHMvY29tcG9uZW50cy9wb2xsLmNvbXBvbmVudC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFtRWtCLEFBR3NCLEFBV0osQUFTVyxXQW5CQyxPQW9CUixXQUNiLElBVndCLGdEQVZULDhCQVdBLDRDQVZTLDhCQVdILGdEQVZDLDZDQVdDLG9EQVZBLHdCQVdFLG9EQVZBLCtDQVd6QixvREFWcUIsbUJBQ3JCIiwiZmlsZSI6Ii9Vc2Vycy9qb2R1cGxlc3Npcy9Xb3JrL1dlZWtkYXkvcG9sbHMvY29tcG9uZW50cy9wb2xsLmNvbXBvbmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyB1c2VTdGF0ZSwgdXNlRWZmZWN0IH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgeyBQcm9ncmVzcywgQnV0dG9uIH0gZnJvbSAnQHdlZWtkYXkvZWxlbWVudHMnXG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCdcbmltcG9ydCB7IHVzZU11dGF0aW9uLCB1c2VTdWJzY3JpcHRpb24gfSBmcm9tICdAYXBvbGxvL3JlYWN0LWhvb2tzJ1xuaW1wb3J0IGdxbCBmcm9tICdncmFwaHFsLXRhZydcblxuY29uc3QgREVMRVRFX1BPTEwgPSBncWxgXG4gIG11dGF0aW9uIGRlbGV0ZV9wb2xscygkaWQ6IEludCkge1xuICAgIGRlbGV0ZV9wb2xscyhcbiAgICAgIHdoZXJlOiB7aWQ6IHtfZXE6ICRpZH19XG4gICAgKSB7XG4gICAgICBhZmZlY3RlZF9yb3dzXG4gICAgfVxuICB9XG5gO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBQb2xsQ29tcG9uZW50KHByb3BzKSB7XG4gIGNvbnN0IFtjb21wbGV0ZSwgc2V0Q29tcGxldGVdID0gdXNlU3RhdGUoZmFsc2UpXG4gIGNvbnN0IFt0b3RhbCwgc2V0VG90YWxdID0gdXNlU3RhdGUoMClcbiAgY29uc3QgW2hpZ2hlc3QsIHNldEhpZ2hlc3RdID0gdXNlU3RhdGUoMClcbiAgY29uc3QgW2V4cGlyZWQsIHNldEV4cGlyZWRdID0gdXNlU3RhdGUoMClcbiAgY29uc3QgW2RlbGV0ZVBvbGwsIGRlbGV0ZURhdGFdID0gdXNlTXV0YXRpb24oREVMRVRFX1BPTEwpXG5cbiAgY29uc3QgdXBkYXRlUG9sbCA9IGFzeW5jICgpID0+IHtcbiAgICBjb25zb2xlLmxvZygnT3BlbiBhY3Rpb24gd2luZG93JylcbiAgfVxuXG4gIGNvbnN0IGNvbmZpcm1EZWxldGVQb2xsID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmIChjb25maXJtKFwiQXJlIHlvdSBzdXJlP1wiKSkge1xuICAgICAgZGVsZXRlUG9sbCh7IHZhcmlhYmxlczogeyBpZDogcHJvcHMuaWQgfSB9KVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHZvdGVPcHRpb24gPSBhc3luYyAob3B0aW9uSWQpID0+IHtcbiAgICBwcm9wcy5vblN1Ym1pdChvcHRpb25JZClcbiAgICBzZXRDb21wbGV0ZSh0cnVlKVxuICB9XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBsZXQgdm90ZUNvdW50SGlnaGVzdCA9IDBcblxuICAgIHByb3BzLm9wdGlvbnMubWFwKG9wdGlvbiA9PiB7XG4gICAgICAvLyBTZWUgaWYgdGhpcyB1c2VyIGhhcyBjb21wbGV0ZWQgdGhlIHBvbGxcbiAgICAgIHByb3BzLnBvbGxWb3Rlcy5tYXAodm90ZSA9PiB7XG4gICAgICAgIGlmICh2b3RlLnVzZXJfaWQgPT0gcHJvcHMuY3VycmVudFVzZXJJZCkgc2V0Q29tcGxldGUodHJ1ZSlcbiAgICAgIH0pXG5cbiAgICAgIC8vIFNldCB0aGUgc2NvcmUgZm9yIHRoZSBoaWdoZXN0IGFtb3VudCBvZiB2b3Rlc1xuICAgICAgdm90ZUNvdW50SGlnaGVzdCA9IHByb3BzLnBvbGxWb3Rlcy5maWx0ZXIodm90ZSA9PiB2b3RlLm9wdGlvbl9pZCA9PSBvcHRpb24uaWQpLmxlbmd0aFxuICAgIH0pXG5cbiAgICBzZXRUb3RhbChwcm9wcy5wb2xsVm90ZXMubGVuZ3RoKVxuICAgIHNldEhpZ2hlc3Qodm90ZUNvdW50SGlnaGVzdClcbiAgICBzZXRFeHBpcmVkKG1vbWVudChwcm9wcy5leHBpcnkpLmlzQmVmb3JlKG1vbWVudCgpKSlcbiAgfSwgW3Byb3BzXSlcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHdpbmRvdy50b3AucG9zdE1lc3NhZ2Uoe1xuICAgICAgdHlwZTogJ3dlZWtkYXknLFxuICAgICAgcGF5bG9hZDoge1xuICAgICAgICB0ZXh0OiAnSGVyZSB3ZSBnbydcbiAgICAgIH1cbiAgICB9LCAnKicpXG4gIH0sIFtdKVxuXG4gIHJldHVybiAoXG4gICAgPFJlYWN0LkZyYWdtZW50PlxuICAgICAgPHN0eWxlIGpzeD57YFxuICAgICAgICAucG9sbC1jb250YWluZXIge1xuICAgICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICAgIGhlaWdodDogZml0LWNvbnRlbnQ7XG4gICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuICAgICAgICAgIGFsaWduLWl0ZW1zOiBzdHJldGNoO1xuICAgICAgICAgIGFsaWduLWNvbnRlbnQ6IGNlbnRlcjtcbiAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4O1xuICAgICAgICB9XG5cbiAgICAgICAgLnBvbGwtaW5uZXIge1xuICAgICAgICAgIGZsZXg6IDE7XG4gICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgICAgICAgYWxpZ24tY29udGVudDogY2VudGVyO1xuICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICAgICAgICB9XG5cbiAgICAgICAgLnByb2dyZXNzLWNvbnRhaW5lciB7XG4gICAgICAgICAgbWFyZ2luLWJvdHRvbTogNXB4O1xuICAgICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICB9XG4gICAgICBgfTwvc3R5bGU+XG5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwicG9sbC1jb250YWluZXJcIj5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJwb2xsLWlubmVyXCI+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJoNCBjb2xvci1kMyB0ZXh0LWxlZnQgdy0xMDAgbWItMFwiPntwcm9wcy50aXRsZX08L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImg1IGNvbG9yLWQwIHRleHQtbGVmdCB3LTEwMCBtYi0xMFwiPntwcm9wcy5kZXNjcmlwdGlvbn08L2Rpdj5cblxuICAgICAgICAgIHsoIWNvbXBsZXRlICYmICFleHBpcmVkKSAmJlxuICAgICAgICAgICAgPFJlYWN0LkZyYWdtZW50PlxuICAgICAgICAgICAgICB7cHJvcHMub3B0aW9ucy5tYXAoKG9wdGlvbiwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJwcm9ncmVzcy1jb250YWluZXJcIiBrZXk9e2luZGV4fT5cbiAgICAgICAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgIHRleHQ9e29wdGlvbi50ZXh0fVxuICAgICAgICAgICAgICAgICAgICAgIHRoZW1lPVwiYmx1ZS1ib3JkZXJcIlxuICAgICAgICAgICAgICAgICAgICAgIHNpemU9XCJmdWxsLXdpZHRoXCJcbiAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17eyBoZWlnaHQ6IDM1IH19XG4gICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gdm90ZU9wdGlvbihvcHRpb24uaWQpfVxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICB9KX1cbiAgICAgICAgICAgIDwvUmVhY3QuRnJhZ21lbnQ+XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgeyhjb21wbGV0ZSB8fCBleHBpcmVkKSAmJlxuICAgICAgICAgICAgPFJlYWN0LkZyYWdtZW50PlxuICAgICAgICAgICAgICB7cHJvcHMub3B0aW9ucy5tYXAoKG9wdGlvbiwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBwb2xsX3ZvdGVzID0gcHJvcHMucG9sbFZvdGVzLmZpbHRlcih2b3RlID0+IHZvdGUub3B0aW9uX2lkID09IG9wdGlvbi5pZClcbiAgICAgICAgICAgICAgICBjb25zdCBwZXJjZW50YWdlID0gcG9sbF92b3Rlcy5sZW5ndGggPT0gMCA/IDAgOiBNYXRoLmZsb29yKChwb2xsX3ZvdGVzLmxlbmd0aCAvIHRvdGFsKSAqIDEwMClcbiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IHBvbGxfdm90ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAnI2YwZjJmNSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBwb2xsX3ZvdGVzLmxlbmd0aCA+PSBoaWdoZXN0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAnI2U5ZWRmMidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICcjZjBmMmY1J1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicHJvZ3Jlc3MtY29udGFpbmVyXCIga2V5PXtpbmRleH0+XG4gICAgICAgICAgICAgICAgICAgIDxQcm9ncmVzc1xuICAgICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U9e3BlcmNlbnRhZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgY29sb3I9e2NvbG9yfVxuICAgICAgICAgICAgICAgICAgICAgIHRleHQ9e29wdGlvbi50ZXh0fVxuICAgICAgICAgICAgICAgICAgICAgIGxhYmVscz17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICA8L1JlYWN0LkZyYWdtZW50PlxuICAgICAgICAgIH1cblxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicCBjb2xvci1kMSB0ZXh0LWxlZnQgdy0xMDAgbXQtNVwiPlxuICAgICAgICAgICAgeyhleHBpcmVkICYmIHByb3BzLmV4cGlyeSkgJiZcbiAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXItMTBcIj5UaGlzIHBvbGwgZXhwaXJlZCB7bW9tZW50KHByb3BzLmV4cGlyeSkuZnJvbU5vdygpfTwvc3Bhbj5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHsoIWV4cGlyZWQgJiYgcHJvcHMuZXhwaXJ5KSAmJlxuICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJtci0xMFwiPlRoaXMgcG9sbCBleHBpcmVzIG9uIHttb21lbnQocHJvcHMuZXhwaXJ5KS5mb3JtYXQoJ0xMJyl9PC9zcGFuPlxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgeyghZXhwaXJlZCAmJiAhcHJvcHMuZXhwaXJ5KSAmJlxuICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJtci0xMFwiPlRoaXMgcG9sbCBkb2VzIG5vdCBleHBpcmU8L3NwYW4+XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB7KHByb3BzLmN1cnJlbnRVc2VySWQgPT0gcHJvcHMudXNlcklkICYmIHByb3BzLnRvb2xzKSAmJlxuICAgICAgICAgICAgICA8c3Ryb25nIGNsYXNzTmFtZT1cImJ1dHRvbiBtci0xMCBjb2xvci1ibHVlXCIgb25DbGljaz17dXBkYXRlUG9sbH0+VXBkYXRlPC9zdHJvbmc+XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB7KHByb3BzLmN1cnJlbnRVc2VySWQgPT0gcHJvcHMudXNlcklkICYmIHByb3BzLnRvb2xzKSAmJlxuICAgICAgICAgICAgICA8c3Ryb25nIGNsYXNzTmFtZT1cImJ1dHRvbiBjb2xvci1yZWRcIiBvbkNsaWNrPXtjb25maXJtRGVsZXRlUG9sbH0+RGVsZXRlPC9zdHJvbmc+XG4gICAgICAgICAgICB9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9SZWFjdC5GcmFnbWVudD5cbiAgKVxufVxuIl19 */\\n/*@ sourceURL=/Users/joduplessis/Work/Weekday/polls/components/poll.component.js */\"), __jsx(\"div\", {\n    className: \"jsx-4211460005\" + \" \" + \"poll-container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: \"jsx-4211460005\" + \" \" + \"poll-inner\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: \"jsx-4211460005\" + \" \" + \"h4 color-d3 text-left w-100 mb-0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97\n    },\n    __self: this\n  }, props.title), __jsx(\"div\", {\n    className: \"jsx-4211460005\" + \" \" + \"h5 color-d0 text-left w-100 mb-10\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98\n    },\n    __self: this\n  }, props.description), !complete && !expired && __jsx(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101\n    },\n    __self: this\n  }, props.options.map((option, index) => {\n    return __jsx(\"div\", {\n      key: index,\n      className: \"jsx-4211460005\" + \" \" + \"progress-container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104\n      },\n      __self: this\n    }, __jsx(Button, {\n      text: option.text,\n      theme: \"blue-border\",\n      size: \"full-width\",\n      style: {\n        height: 35\n      },\n      onClick: () => voteOption(option.id),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105\n      },\n      __self: this\n    }));\n  })), (complete || expired) && __jsx(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }, props.options.map((option, index) => {\n    const poll_votes = props.pollVotes.filter(vote => vote.option_id == option.id);\n    const percentage = poll_votes.length == 0 ? 0 : Math.floor(poll_votes.length / total * 100);\n    const color = poll_votes ? '#f0f2f5' : poll_votes.length >= highest ? '#e9edf2' : '#f0f2f5';\n    return __jsx(\"div\", {\n      key: index,\n      className: \"jsx-4211460005\" + \" \" + \"progress-container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    }, __jsx(Progress, {\n      percentage: percentage,\n      color: color,\n      text: option.text,\n      labels: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131\n      },\n      __self: this\n    }));\n  })), __jsx(\"div\", {\n    className: \"jsx-4211460005\" + \" \" + \"p color-d1 text-left w-100 mt-5\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143\n    },\n    __self: this\n  }, expired && props.expiry && __jsx(\"span\", {\n    className: \"jsx-4211460005\" + \" \" + \"mr-10\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145\n    },\n    __self: this\n  }, \"This poll expired \", moment(props.expiry).fromNow()), !expired && props.expiry && __jsx(\"span\", {\n    className: \"jsx-4211460005\" + \" \" + \"mr-10\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148\n    },\n    __self: this\n  }, \"This poll expires on \", moment(props.expiry).format('LL')), !expired && !props.expiry && __jsx(\"span\", {\n    className: \"jsx-4211460005\" + \" \" + \"mr-10\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151\n    },\n    __self: this\n  }, \"This poll does not expire\"), props.currentUserId == props.userId && props.tools && __jsx(\"strong\", {\n    onClick: updatePoll,\n    className: \"jsx-4211460005\" + \" \" + \"button mr-10 color-blue\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154\n    },\n    __self: this\n  }, \"Update\"), props.currentUserId == props.userId && props.tools && __jsx(\"strong\", {\n    onClick: confirmDeletePoll,\n    className: \"jsx-4211460005\" + \" \" + \"button color-red\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }, \"Delete\")))));\n}","map":{"version":3,"sources":["/Users/joduplessis/Work/Weekday/polls/components/poll.component.js"],"names":["React","useState","useEffect","Progress","Button","moment","useMutation","useSubscription","gql","DELETE_POLL","PollComponent","props","complete","setComplete","total","setTotal","highest","setHighest","expired","setExpired","deletePoll","deleteData","updatePoll","console","log","confirmDeletePoll","confirm","variables","id","voteOption","optionId","onSubmit","voteCountHighest","options","map","option","pollVotes","vote","user_id","currentUserId","filter","option_id","length","expiry","isBefore","window","top","postMessage","type","payload","text","title","description","index","height","poll_votes","percentage","Math","floor","color","fromNow","format","userId","tools"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { Progress, Button } from '@weekday/elements'\nimport moment from 'moment'\nimport { useMutation, useSubscription } from '@apollo/react-hooks'\nimport gql from 'graphql-tag'\n\nconst DELETE_POLL = gql`\n  mutation delete_polls($id: Int) {\n    delete_polls(\n      where: {id: {_eq: $id}}\n    ) {\n      affected_rows\n    }\n  }\n`;\n\nexport default function PollComponent(props) {\n  const [complete, setComplete] = useState(false)\n  const [total, setTotal] = useState(0)\n  const [highest, setHighest] = useState(0)\n  const [expired, setExpired] = useState(0)\n  const [deletePoll, deleteData] = useMutation(DELETE_POLL)\n\n  const updatePoll = async () => {\n    console.log('Open action window')\n  }\n\n  const confirmDeletePoll = async () => {\n    if (confirm(\"Are you sure?\")) {\n      deletePoll({ variables: { id: props.id } })\n    }\n  }\n\n  const voteOption = async (optionId) => {\n    props.onSubmit(optionId)\n    setComplete(true)\n  }\n\n  useEffect(() => {\n    let voteCountHighest = 0\n\n    props.options.map(option => {\n      // See if this user has completed the poll\n      props.pollVotes.map(vote => {\n        if (vote.user_id == props.currentUserId) setComplete(true)\n      })\n\n      // Set the score for the highest amount of votes\n      voteCountHighest = props.pollVotes.filter(vote => vote.option_id == option.id).length\n    })\n\n    setTotal(props.pollVotes.length)\n    setHighest(voteCountHighest)\n    setExpired(moment(props.expiry).isBefore(moment()))\n  }, [props])\n\n  useEffect(() => {\n    window.top.postMessage({\n      type: 'weekday',\n      payload: {\n        text: 'Here we go'\n      }\n    }, '*')\n  }, [])\n\n  return (\n    <React.Fragment>\n      <style jsx>{`\n        .poll-container {\n          width: 100%;\n          height: fit-content;\n          display: flex;\n          flex-direction: column;\n          align-items: stretch;\n          align-content: center;\n          justify-content: center;\n          margin-bottom: 20px;\n        }\n\n        .poll-inner {\n          flex: 1;\n          flex-direction: column;\n          display: flex;\n          align-items: center;\n          align-content: center;\n          justify-content: center;\n        }\n\n        .progress-container {\n          margin-bottom: 5px;\n          width: 100%;\n        }\n      `}</style>\n\n      <div className=\"poll-container\">\n        <div className=\"poll-inner\">\n          <div className=\"h4 color-d3 text-left w-100 mb-0\">{props.title}</div>\n          <div className=\"h5 color-d0 text-left w-100 mb-10\">{props.description}</div>\n\n          {(!complete && !expired) &&\n            <React.Fragment>\n              {props.options.map((option, index) => {\n                return (\n                  <div className=\"progress-container\" key={index}>\n                    <Button\n                      text={option.text}\n                      theme=\"blue-border\"\n                      size=\"full-width\"\n                      style={{ height: 35 }}\n                      onClick={() => voteOption(option.id)}\n                    />\n                  </div>\n                )\n              })}\n            </React.Fragment>\n          }\n\n          {(complete || expired) &&\n            <React.Fragment>\n              {props.options.map((option, index) => {\n                const poll_votes = props.pollVotes.filter(vote => vote.option_id == option.id)\n                const percentage = poll_votes.length == 0 ? 0 : Math.floor((poll_votes.length / total) * 100)\n                const color = poll_votes\n                                ? '#f0f2f5'\n                                : poll_votes.length >= highest\n                                  ? '#e9edf2'\n                                  : '#f0f2f5'\n\n                return (\n                  <div className=\"progress-container\" key={index}>\n                    <Progress\n                      percentage={percentage}\n                      color={color}\n                      text={option.text}\n                      labels={true}\n                    />\n                  </div>\n                )\n              })}\n            </React.Fragment>\n          }\n\n          <div className=\"p color-d1 text-left w-100 mt-5\">\n            {(expired && props.expiry) &&\n              <span className=\"mr-10\">This poll expired {moment(props.expiry).fromNow()}</span>\n            }\n            {(!expired && props.expiry) &&\n              <span className=\"mr-10\">This poll expires on {moment(props.expiry).format('LL')}</span>\n            }\n            {(!expired && !props.expiry) &&\n              <span className=\"mr-10\">This poll does not expire</span>\n            }\n            {(props.currentUserId == props.userId && props.tools) &&\n              <strong className=\"button mr-10 color-blue\" onClick={updatePoll}>Update</strong>\n            }\n            {(props.currentUserId == props.userId && props.tools) &&\n              <strong className=\"button color-red\" onClick={confirmDeletePoll}>Delete</strong>\n            }\n          </div>\n        </div>\n      </div>\n    </React.Fragment>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}